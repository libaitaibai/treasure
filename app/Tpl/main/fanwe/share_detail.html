<?php
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/style.css";
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/utils/weebox.css";
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/utils/fanweUI.css";
$this->_var['pagecss'][] = $this->_var['TMPL_REAL']."/css/share_show.css";

$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.bgiframe.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.weebox.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.pngfix.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.animateToClass.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.timer.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/jquery.SuperSlide.2.1.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/utils/lazyload.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/fanwe_utils/fanweUI.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/fanwe_utils/fanweUI.js";

$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/script.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/script.js";
$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/login_panel.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/login_panel.js";

$this->_var['pagejs'][] = $this->_var['TMPL_REAL']."/js/page_js/share_show.js";
$this->_var['cpagejs'][] = $this->_var['TMPL_REAL']."/js/page_js/share_show.js";
?>
{include file="inc/header.html"}
	<div class="x-all">
	{if $is_my eq 0}
	    <div class="x-userinfobox clearfix">
	        <img class="x-userpic f_l" data_id="{$share_info.user_id}" src="{function name="get_user_avatar" uid=$share_info.user_id type="big"}" />
		    <div class="x-usercont ml20">
		        <p class="nickname">{$share_info.user_name}</p>
	            <p class="nickid">ID：<strong>{$share_info.user_id}</strong></p>
		    </div>
		</div>
		{/if}
		<div class="x-sharedetail">
			<div class="x-sharetit">
				<p class="sharetit tc">{$share_info.title}</p>
				<input type="hidden" value="{$share_info.id}" name="share_id"/>
				<input type="hidden" value="{$is_user}" name="is_user"/>
				<div class="share">
				   	<!-- JiaThis Button BEGIN -->
						<div class="jiathis_style">
							<span class="jiathis_txt">分享到：</span>
							<a class="jiathis_button_tsina"><i class="icon iconfont"></i></a>   
							<a class="jiathis_button_weixin"><i class="icon iconfont"></i></a>
							<a class="jiathis_button_cqq"><i class="icon iconfont"></i></a>
							<a class="jiathis_button_qzone"><i class="icon iconfont"></i></a>
							<a class="jiathis_button_douban"><i class="icon iconfont"></i></a>
							<a class="jiathis_button_copy"><i class="icon iconfont"></i></a>
							<a class="jiathis_counter_style"></a>
						</div>
						<script type="text/javascript">
							 var jiathis_config = {
								sm:"tsina,weixin,cqq,qzone,douban,copy",
								siteNum:6,
							 	title:"{$share_title}",
							    url:"{$share_url}",
							    
							};
						</script>
						<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
						
						<!-- JiaThis Button END -->
                </div>
                <div class="time tc"><span>晒单时间：{function name="to_date" v=$share_info.create_time}</span></div>
			</div>
			<div class="x-windetail">
				<div class="owner f_l">
					<div class="avatar f_l">
						<a href="{url x="index" r="uc_home#index" p="id=$duobao_item.luck_user_id" }"><img class="x-userpic f_l" src="{function name="get_user_avatar" uid=$duobao_item.luck_user_id type="big"}" /></a>
					</div>
					<div class="info">
						<p>获得者：<a href="{url x="index" r="home#index" p="id=$duobao_item.luck_user_id" }">{$duobao_item.luck_user_name}</a></p>
						<p>总共参与：<strong class="x_red">{$duobao_item.luck_user_buy_count}</strong>人次</p>
						<p>幸运号码：<strong class="x_red">{$duobao_item.lottery_sn}</strong></p>
						<p>揭晓时间：{function name="to_date" v=$duobao_item.lottery_time}</p>
					</div>
				</div>
				<div class="goods">
					<div class="pic f_l">
						<a href="{url x="index" r="duobao#index" p="id=$duobao_item.id"}"><img class="x-userpic f_l" src="{$duobao_item.icon}" /></a>
					</div>
					<div class="info">
						<p class="name">期号：<a href="#">{$duobao_item.id}</a></p>
						<p>总需：{$duobao_item.max_buy}人次</p>
						<p class="go-more"><a href="{url x="index" r="duobao" p="dbid=$duobao_id" }">最新一期正在进行中...</a></p>
					</div>
				</div>
			</div>
			<div class="x-sharecont">
                <i class="ico quote quote-b"></i>
                <i class="ico quote quote-a"></i>
                <div class="text">{$share_info.content}</div>
            </div>
            <div class="x-sharepics">
            	{if $img_list}
	            	{foreach from=$img_list item=img_item}
	            		<div class="item"><img src="{function name="get_spec_image" v=$img_item.o_path w="540"}"></div>
            		{/foreach}
            	{/if}
            </div>
			<div class="fb_comments">

				<div class="box-content box-login">
					<div class="box-textarea-block">
						<textarea class="box-textarea J_Textarea" id="J_Textarea" placeholder="说两句吧..."></textarea>
					</div>
					<div class="box-info">
						<div class="box-operate">
                          <div class="box-commentBtn box-commentBtn--able J_PostBtn" id="J_PostBtn">发布评论</div>
						</div>
					</div>
			</div>
			<div class="comment-short" id="J_Short">
				<div class="comment-title">
					<p class="comment-all">全部评论</p>
				</div>
				<div id="containers">
                    {if $has_comment eq 0}
					<div class="comment-moreBtn J_shortMore">暂无评论</div>
					{/if}

				</div>


			</div>

		</div>
	</div>
		<script type="text/javascript">






            $(function(){

                var url = APP_ROOT + "/index.php?ctl=comment&act=publish";//发表
                var getList = APP_ROOT + "/index.php?ctl=comment&act=comments";//列表

                //获取列表
				function getlist(parent_id,page){

				    var share_id = $('input[name="share_id"]').val();
				    if(!share_id){
				        return false;
					}
                    $.ajax({
                        type:'get',
                        url:getList,
                        data:{
                            share_id:share_id,
							 parent_id:parent_id,
							page:page
                        },
                        dataType:'json',
                        success:function(xhr){


                            if(parent_id){ //内评论
                                $('.J_shortMoresB').remove();
                                $('.J_ShortComment'+parent_id).find('.J_ReplyBlock').append(xhr.data.html);
								var $obj = $('.J_ShortComment'+parent_id).find('.J_shortMoresB');
                                var page =  $obj.attr('data-pageid');
                                var pages =  $obj.attr('data-pagesid');


							}else{ //外评论
                                $('.J_shortMores').remove();
                                $('#containers').append(xhr.data.html);
                                var $obj = $('#containers').find('.J_shortMores');
                                var page = $obj.attr('data-pageid');
                                var pages = $obj.attr('data-pagesid');

							}


                            if(page>=pages){
                                $obj.remove();
                            }
                        }

                    });


				}

                //首次加载
				getlist(0,1);



                function textareak(){

                    var str = '<div class="reply-box J_ReplyBox"> ' +
                        '<div class="reply-box-block"> ' +
                        '<textarea class="reply-box-textarea J_ReplyTextArea"></textarea> ' +
                        '</div> ' +
                        '<div class="reply-box-btn J_ReplyBtn" id="J_ReplyBtn">回复</div></div>';

                    return str;

                }

                function reply(parent_id,target_id,content){

                    var is_user = $('input[name="is_user"]').val();
                    if(!is_user){
                        alert('请先登录');
                        return false;
                    }
                    var share_id = $('input[name="share_id"]').val();
                    if(!content){
                        alert('说两句吧');
                        return false;
                    }

                    $.ajax({

                        type:'post',
                        url:url,
                        data:{
                            share_id:share_id,
                            content:content,
                            target_id:target_id,
							parent_id:parent_id
                        },
                        dataType:'json',
                        success:function(xhr){
                            if(xhr.code!=200){
                                alert(xhr.msg);
                                return false;
							}


                            if(parent_id){
                                $('.J_ReplyBox').siblings('.J_CommentOperate').find('.reply-visited').text('回复').removeClass('reply-visited');
                                $('.J_ReplyBox').remove();

                                $('.J_shortMoresBtn'+parent_id).parents('.J_ReplyBlock').empty().addClass('reply');
							}else{
                                $('#containers').empty();
							}
                            getlist(parent_id,1);
                        }

                    });



                }



                $('.reply-operate-item').live('click',function(){

                    var target_id = $(this).attr('data-userid');
                   // var parent_id = $(this).attr('data-pid');
                    $('.J_ReplyBox').remove();
                    $('.J_Reply').text('回复');
                    if($(this).hasClass('reply-visited')){
                        $('.J_ReplyBox').remove();
                        $(this).removeClass('reply-visited').text('回复');
                        $('#J_ReplyBtn').unbind();

                    }else{
                        $(this).addClass('reply-visited').text('收起');
                        $(this).parents('.reply-block').append(textareak());
                        $('#J_ReplyBtn').bind('click',function(){
                            var content = $(this).parent('.J_ReplyBox').find('textarea').val();
                            var parent_id = $(this).parents('.J_ShortComment').attr('data-pid');
                            $(this).parents('.J_ReplyBlock').empty();
                            reply(parent_id,target_id,content);

                        });
                    }

                });

                $('.comment-operate-reply').live('click',function(){
                    var target_id = $(this).attr('data-userid');
                    //var parent_id = $(this).attr('data-pid');
                    $('.J_ReplyBox').remove();
                    $('.J_Reply').text('回复');
                    if($(this).hasClass('reply-visited')){
                        $('.J_ReplyBox').remove();
                        $(this).removeClass('reply-visited').text('回复');
                        $('#J_ReplyBtn').unbind();

                    }else{
                        $(this).addClass('reply-visited').text('收起');
                        $(this).parents('.comment-block').append(textareak());
                        $('#J_ReplyBtn').bind('click',function(){
                            var content = $(this).parent('.J_ReplyBox').find('textarea').val();
                            var parent_id = $(this).parents('.J_ShortComment').attr('data-pid');
                            $(this).parents('.comment-block').find('.J_ReplyBlock').empty().addClass('reply');
                            reply(parent_id,target_id,content);

                        });
                    }

                });


                $('#J_PostBtn').bind('click',function(){

                    var content = $('#J_Textarea').val();
                    reply(0,0,content);


                });

                //查看更多
                $('.J_shortMoresB').live('click',function(){

                       var parent_id = $(this).parents('.J_ShortComment').attr('data-pid');
                       var page = parseInt($(this).attr('data-pageid'),10);
                       getlist(parent_id,page+1);

				});

                //查看更多评论
                $('.J_shortMores').live('click',function(){

                    var page = parseInt($(this).attr('data-pageid'),10);
                    getlist(0,page+1);

                });

            });


		</script>
{include file="inc/footer.html"}